"use strict";(self.webpackChunkreact_chess=self.webpackChunkreact_chess||[]).push([[506],{506:function(r,n,e){e.r(n),e.d(n,{default:function(){return g}});var i,t,o,a=e(152);function c(r,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(r,i.key,i)}}function u(r,n,e){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];r.forEach((function(r){var t=(0,a.Z)(r,2),o=t[0],c=t[1],u=n(o,c);u.figure?(null===u||void 0===u?void 0:u.color)!==e&&(u.isUnderAtack=!0):!i&&(u.canMove=!0)}))}function l(r,n,e){var i=r.x,t=r.y,o=r.color,a=[i,t];do{var c=n((a=e(a))[0],a[1]);if(null!==c&&void 0!==c&&c.figure){(null===c||void 0===c?void 0:c.color)!==o&&(c.isUnderAtack=!0);break}c.canMove=!0}while(n(a[0],a[1]).id)}function f(r,n){[function(r){var n=(0,a.Z)(r,2);return[n[0]+1,n[1]]},function(r){var n=(0,a.Z)(r,2);return[n[0]-1,n[1]]},function(r){var n=(0,a.Z)(r,2);return[n[0],n[1]-1]},function(r){var n=(0,a.Z)(r,2);return[n[0],n[1]+1]}].forEach((function(e){l(r,n,e)}))}function h(r,n){[function(r){var n=(0,a.Z)(r,2);return[n[0]+1,n[1]+1]},function(r){var n=(0,a.Z)(r,2);return[n[0]-1,n[1]-1]},function(r){var n=(0,a.Z)(r,2);return[n[0]+1,n[1]-1]},function(r){var n=(0,a.Z)(r,2);return[n[0]-1,n[1]+1]}].forEach((function(e){l(r,n,e)}))}function s(r,n,e){return r.find((function(r){return r.x===n&&r.y===e}))}function v(r){return JSON.parse(JSON.stringify(r))}function d(r,n,e){n.forEach((function(n){var i=s(r,n.x,n.y);i&&(i.figure?(null===i||void 0===i?void 0:i.color)!==e&&(i.isUnderAtack=!0):i.canMove=!0)}))}function k(r,n,e){return e.filter((function(e){var i=p(r,n,e),t=(0,a.Z)(i,1)[0];return n.color&&!b(t,n.color)}))}function p(r,n,e){var i=n.x,t=n.y,o=e.x,a=e.y,c=v(r),u=s(c,i,t),l=s(c,o,a);if(!u||!l)return[[],null,null];var f=l.figure,h=l.color;return l.figure=null===u||void 0===u?void 0:u.figure,l.color=null===u||void 0===u?void 0:u.color,u.figure=null,u.color=null,[c,f,h]}function b(r,n){var e=v(r);r.forEach((function(r){if(r.figure&&r.color!==n){var i=_(e,r.x,r.y);r.color&&d(e,i,r.color)}}));var i=function(r,n){return r.find((function(r){return r.color===n&&"king"===r.figure}))}(e,n);return!(null===i||void 0===i||!i.isUnderAtack)}function _(r,n,e){var t=v(r),o=s(r,n,e),c=function(r,n){var e=s(t,r,n);return e||{}};switch(null===o||void 0===o?void 0:o.figure){case i.knight:!function(r,n){var e=r.x,i=r.y;u([[e-1,i+2],[e+1,i+2],[e-1,i-2],[e+1,i-2],[e-2,i+1],[e+2,i+1],[e-2,i-1],[e+2,i-1]],n,r.color)}(o,c);break;case i.pawn:!function(r,n){var e=r.x,i=r.y,t=r.color,o="white"===t?1:-1,c=[[e,i+1*o]],l=[[e-1,i+1*o],[e+1,i+1*o]];("white"===t?1===i:6===i)&&c.push([e,i+2*o]);for(var f=0,h=c;f<h.length;f++){var s=h[f],v=(0,a.Z)(s,2),d=n(v[0],v[1]);if(null!==d&&void 0!==d&&d.figure)break;d.canMove=!0}u(l,n,t,!0)}(o,c);break;case i.rook:!function(r,n){f(r,n)}(o,c);break;case i.bishop:!function(r,n){h(r,n)}(o,c);break;case i.queen:!function(r,n){h(r,n),f(r,n)}(o,c);break;case i.king:!function(r,n){var e=r.x,i=r.y;u([[e-1,i],[e-1,i+1],[e,i+1],[e+1,i+1],[e+1,i],[e+1,i-1],[e,i-1],[e-1,i-1]],n,r.color)}(o,c)}return t.filter((function(r){return r.canMove||r.isUnderAtack}))}!function(r){r.rook="rook",r.knight="knight",r.bishop="bishop",r.queen="queen",r.king="king",r.pawn="pawn"}(i||(i={})),function(r){r.b="black",r.w="white"}(t||(t={})),function(r){r.r="rook",r.h="knight",r.b="bishop",r.q="queen",r.k="king",r.p="pawn"}(o||(o={}));var g=function(){function r(){!function(r,n){if(!(r instanceof n))throw new TypeError("Cannot call a class as a function")}(this,r),this._playerColor=void 0,this._isCheck=void 0,this._isCheckmate=void 0,this._board=void 0,this._capturedFiguresMap=void 0,this._playerColor="white",this._isCheck=!1,this._isCheckmate=!1,this._board=this._getDefaultBoard(),this._capturedFiguresMap={white:{queen:0,knight:0,rook:0,bishop:0,pawn:0},black:{queen:0,knight:0,rook:0,bishop:0,pawn:0}}}var n,e,i;return n=r,e=[{key:"board",get:function(){return v(this._board)}},{key:"isCheck",get:function(){return this._isCheck}},{key:"isCheckmate",get:function(){return this._isCheckmate}},{key:"playerColor",get:function(){return this._playerColor}},{key:"capturedFiguresMap",get:function(){return v(this._capturedFiguresMap)}},{key:"_getDefaultBoard",value:function(){var r=[];return"\n    wr wh wb wq wk wb wh wr\n    wp wp wp wp wp wp wp wp\n    .. .. .. .. .. .. .. ..\n    .. .. .. .. .. .. .. ..\n    .. .. .. .. .. .. .. ..\n    .. .. .. .. .. .. .. ..\n    bp bp bp bp bp bp bp bp\n    br bh bb bq bk bb bh br\n".split(/[\s]/).filter((function(r){return r})).forEach((function(n,e){var i=Math.trunc(e/8),c=e%8,u={id:"cell_".concat(i,"_").concat(c),x:c,y:i,figure:null,color:null,isSelected:!1,isUnderAtack:!1,canMove:!1};if(".."!==n){var l=n.split(""),f=(0,a.Z)(l,2),h=f[0],s=f[1];u.figure=o[s],u.color=t[h]}r.push(u)})),r}},{key:"_captureFigure",value:function(r,n){if(r&&"king"!==r&&n){var e="white"===n?"black":"white";this._capturedFiguresMap[e][r]+=1}}},{key:"_changePlayer",value:function(){this._playerColor="white"===this._playerColor?"black":"white"}},{key:"_clearBoard",value:function(){this._board.forEach((function(r){r.canMove=!1,r.isUnderAtack=!1,r.isSelected=!1}))}},{key:"_updateBoard",value:function(r){this._board.length=0,this._board=v(r)}},{key:"select",value:function(r,n){var e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];!e&&this._clearBoard();var i=s(this._board,r,n);if(i&&i.figure&&i.color){i.isSelected=!0;var t=_(this.board,r,n),o=k(this.board,i,t);d(this._board,o,i.color)}}},{key:"move",value:function(r,n){var e=function(r){return r.find((function(r){return r.isSelected}))}(this._board),i=s(this._board,r,n);if(e&&i){var t=p(this._board,e,i),o=(0,a.Z)(t,3),c=o[0],u=o[1],l=o[2];this._updateBoard(c),this._captureFigure(u,l),this._changePlayer(),this._clearBoard(),this._setCheckAndCheckmate()}}},{key:"_setCheckAndCheckmate",value:function(){var r=this;if(this._isCheck=b(this._board,this._playerColor),this._isCheckmate=!1,this._isCheck){this._board.forEach((function(n){n.color===r._playerColor&&r.select(n.x,n.y,!0)}));var n=this._board.filter((function(r){return r.canMove||r.isUnderAtack}));this._isCheckmate=!n.length,this._clearBoard()}}}],e&&c(n.prototype,e),i&&c(n,i),Object.defineProperty(n,"prototype",{writable:!1}),r}()}}]);
//# sourceMappingURL=506.6b20668b.chunk.js.map